<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.bootcdn.net/ajax/libs/smoothie/1.9.0/smoothie.js"></script>
    <script type="text/javascript">
        // Randomly add a data point every 500ms
        var random = new TimeSeries();
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            if (request.readyState === 4) {
                if (request.status === 200) {
                    info = JSON.parse(request.responseText);
                    console.log(info)
                    random.append(new Date().getTime(), info['value']);
                }
                else console.log(request.status)
            }
        }
        var working = false;

        function createTimeline() {
            var chart = new SmoothieChart();
            chart.addTimeSeries(random, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
            chart.streamTo(document.getElementById("chart"), 500);
        }

        function start_stop_button() {
            if (working) {
                clearInterval(job_id);
                random.append(new Date().getTime(), 0);
                working = false;
            } else {
                job_id = setInterval(function () {
                    request.open('GET', 'http://127.0.0.1:5000/data');
                    request.send();
                }, 500);
                working = true;
            }
        }

        function show_cam_button() {
            var request = new XMLHttpRequest();
            request.onreadystatechange = function () {
                if (request.readyState === 4) {
                    if (request.status === 200) {
                        var img1 = document.getElementById("cam1");
                        info = JSON.parse(request.responseText);
                        console.log(info)
                        img1.setAttribute('src', 'data:image/jpg;base64,' + info['value']);
                    }
                    else console.log(request.status)
                }
            }
            request.open('GET', 'http://127.0.0.1:5000/camera');
            request.send();
        }
    </script>
</head>

<body onload="createTimeline()">

    <canvas id="chart" width="400" height="100"></canvas>
    <br>
    <button onclick="start_stop_button()">Start/Stop</button>
    <button onclick="show_cam_button()">Show camera</button>
    <br>
    <img id="cam1">
</body>

</html>